version: 2.0

default_steps: &default_steps
  - checkout
  - run: npm install tap-junit
  - run: npm install
  - run: npm run test:ci | ./node_modules/tap-junit/bin/tap-junit --output test_results --name junit
  - run: npm run cover:ci
  - store_artifacts:
      path: test_results
      prefix: test_results
  - store_test_results:
      path: test_results
  - store_artifacts:
      path: coverage
      prefix: coverage

default_env: &default_env
  - CODECLIMATE_REPO_TOKEN: c92188dcdeaca7d9732f8ea38fdd41d6bff18dc27a8d6f8b64a5b1311b7b6c21

jobs:
  "node-6":
    docker:
      - image: circleci/node:6-browsers
    environment: *default_env
    steps: *default_steps
  "node-8":
    docker:
      - image: circleci/node:8-browsers
    environment: *default_env
    steps: *default_steps

workflows:
  version: 2
  build:
    jobs:
      - "node-6"
      - "node-8"
